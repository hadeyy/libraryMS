{% extends 'base.html.twig' %}

{% block title %}Catalog{% endblock %}
{% block content %}
    <div class="col-xs-12 col-sm-12 col-md-9">
        <h2>
            {% block catalogTitle %}
                All books
                {% if is_granted("ROLE_LIBRARIAN") %}
                    <a href="{{ path('new-book') }}" id="newBookLink" class="new-btn">
                        <button class="btn float-right"><span class="plus">+</span>NEW</button>
                    </a>
                {% endif %}
            {% endblock %}
        </h2>
        <hr>
        <div class="row book-list">
            {% if books|length > 0 %}
                {% for book in books %}
                    {% include 'catalog/_book_preview.html.twig' with {'book': book } %}
                {% endfor %}
            {% else %}
                <h4 class="no-data">Nothing to display.</h4>
            {% endif %}
        </div>

        <!-- Page navigation -->
        {% if maxPages > 1 %}
            <ul class="row d-flex justify-content-center align-items-center pagination">
                <a href="{{ path('catalog', {page: currentPage-1 < 1 ? 1 : currentPage-1}) }}"
                   class="d-flex align-items-center {{ currentPage == 1 ? 'disabled' }}">
                    <li>
                        <span class="fa fa-angle-left"></span>
                    </li>
                </a>

                {% for i in 1..maxPages %}
                    <a href="{{ path('catalog', {page: i}) }}"
                       class="d-flex align-items-center {{ currentPage == i ? 'active disabled' }}">
                        <li>
                            {{ i }}
                        </li>
                    </a>
                {% endfor %}

                <a href="{{ path('catalog', {page: currentPage+1 <= maxPages ? currentPage+1 : currentPage}) }}"
                   class="d-flex align-items-center {{ currentPage == maxPages ? 'disabled' }}">
                    <li>
                        <span class="fa fa-angle-right"></span>
                    </li>
                </a>
            </ul>
        {% endif %}
        <!-- page navigation end. -->
    </div>
    <div class="col-xs-12 col-sm-12 col-md-3">
        {% include 'catalog/_filters.html.twig' with {'authors': authors, 'genres': genres } %}
    </div>
{% endblock %}
{% block javascripts %}
    <script>
        $(function () {
            let activeModal, currentIDNumber, currentModal, nextModal, prevModal;
            let modals = $(document.getElementsByClassName('modal'));
            let firstModal = $(modals[0]);
            let lastModal = $(modals[modals.length - 1]);

            firstModal.find("span.prev").css("display", "none");
            lastModal.find("span.next").css("display", "none");

            $('span.next').on("click", function () {
                activeModal = $(this)[0].parentNode.parentNode.parentNode;
                currentIDNumber = jQuery.inArray(activeModal, modals);
                currentModal = $(modals[currentIDNumber]);
                nextModal = $(modals[currentIDNumber + 1]);

                currentModal.modal("hide");
                nextModal.modal("show");
            });

            $('span.prev').on("click", function () {
                activeModal = $(this)[0].parentNode.parentNode.parentNode;
                currentIDNumber = jQuery.inArray(activeModal, modals);
                currentModal = $(modals[currentIDNumber]);
                prevModal = $(modals[currentIDNumber - 1]);

                currentModal.modal("hide");
                prevModal.modal("show");
            });
        });
    </script>
{% endblock %}
